---
title: "Bulk_Density"
author: "Harnay"
date: "2025-01-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load Libraries
```{r}
library(tidyverse)
library(gridExtra)
library(cowplot)
library(sf)
library(ggspatial)
library(ggmap)
#library(ggsn)
library(patchwork)

```

Load data and metadata
```{r}
#load wax data
wax.data <- read.csv("Data/bulk_density_data.csv", header=TRUE)
colnames(wax.data) <- c("Sample.ID", "DW.clean.g", "DW.wax.g", "BW.wax.g", "Temperature.C", "Page.Num","Notes")
wax.data$Sample.ID <- as.character(wax.data$Sample.ID)
wax.data <- na.omit(wax.data)
nrow(wax.data)==length(unique(wax.data$Sample.ID))
duplicated_names <- wax.data[duplicated(wax.data$Sample.ID), ]
print(duplicated_names)

species.id <- read.csv("/Users/pierrickharnay/Documents/MyProjects/Pocillopora-Lagoon-Abundance/Data/Haplotype_data.csv", header=TRUE)
species.id$Species <- factor(species.id$Species)
species.id$Sample.ID <- as.character(species.id$Sample.ID)

# add size data
datasize <- read.csv("/Users/pierrickharnay/Documents/MyProjects/Pocillopora-Lagoon-Abundance/Data/POC_RA_Size.csv", header = TRUE) %>% 
  select(c("Sample.ID", "Diameter.1", "Diameter.2", "Diameter.3"))

#for sample ID link with size and species ID
metadata <- read.csv("/Users/pierrickharnay/Documents/MyProjects/Pocillopora-Lagoon-Abundance/Data/POC_ID_RA_list.csv", header=TRUE) %>%
  select(c("Number", "Stage", "Timing", "Site", "Transect")) %>%
  filter(Timing=="Pre_bleach")

colnames(metadata) <- c("Sample.ID", "Stage", "Timing", "Site", "Transect")
metadata$Sample.ID <- as.character(metadata$Sample.ID)

data <- left_join(wax.data, species.id, by= "Sample.ID")
data <- left_join(data, metadata, by= "Sample.ID")

#for sizes 
datasize$Sample.ID <- as.character(datasize$Sample.ID)

data_1 <- left_join(data, datasize, by = "Sample.ID")

#to double check with all the fusion worked correclty 
missing_in_datasize <- data %>%
  filter(!Sample.ID %in% datasize$Sample.ID)

cat("Number of unmatched Sample.IDs in datasize:", nrow(missing_in_datasize), "\n")
print(missing_in_datasize$Sample.ID)

unmatched_in_data <- datasize %>%
  filter(!Sample.ID %in% data$Sample.ID)

cat("Number of Sample.IDs in datasize not found in data:", nrow(unmatched_in_data), "\n")
print(unmatched_in_data$Sample.ID)

# removing the data who we do not have data about sizes
# Remove rows with any NA values
data_1_clean <- data_1 %>%
  drop_na()

# Check how many rows remain
cat("Number of fully matched rows with no NA:", nrow(data_1_clean), "\n")


```

#Calculate surface area (Volume enclosed) using the standard curve
```{r}

#View the range of DW.clean.g
range(data$DW.clean.g)
boxplot(data$DW.clean.g)
hist(data$DW.clean.g)

#View the range of DW.wax.g
range(data$DW.wax.g)
boxplot(data$DW.wax.g)
hist(data$DW.wax.g)

str(data)

data <- data %>%
  mutate(Vol.enc = DW.wax.g - BW.wax.g) %>%
  mutate(Bulk.Density = DW.clean.g/Vol.enc)

#check the range of bulk density values
#1.44 - 2.22 reported 10.7717/peerj.3191
range(data$Bulk.Density)
boxplot(data$Bulk.Density)
hist(data$Bulk.Density)

```
#Calculate surface area (Volume enclosed) using the standard curve WITH THE DATASIZE ADDED SO MODIFICATION OF THE SCRIPT 
```{r}

#View the range of DW.clean.g
range(data_1_clean$DW.clean.g)
boxplot(data_1_clean$DW.clean.g)
hist(data_1_clean$DW.clean.g)

#View the range of DW.wax.g
range(data_1_clean$DW.wax.g)
boxplot(data_1_clean$DW.wax.g)
hist(data_1_clean$DW.wax.g)

str(data_1_clean)

data_1_clean <- data_1_clean %>%
  mutate(Vol.enc = DW.wax.g - BW.wax.g) %>%
  mutate(Bulk.Density = DW.clean.g/Vol.enc)

#check the range of bulk density values
#1.44 - 2.22 reported 10.7717/peerj.3191
range(data_1_clean$Bulk.Density)
boxplot(data_1_clean$Bulk.Density)
hist(data_1_clean$Bulk.Density)

```

Check relationship between initial weight and bulk density to see if there are artifacts of starting small (e.g., balance resolution, user artifacts)

```{r}
data %>% 
  ggplot(aes(x=DW.clean.g, y=Bulk.Density))+
  geom_point()

```
Check relationship between initial weight and bulk density to see if there are artifacts of starting small (e.g., balance resolution, user artifacts) WITH THE DATASIZE ADDED SO MODIFICATION OF THE SCRIPT 

```{r}
data_1_clean %>% 
  ggplot(aes(x=DW.clean.g, y=Bulk.Density))+
  geom_point()

```

Check data entry for values less that 1.4
```{r}

QC.Checks <- data %>%
  filter(Bulk.Density <1.4, na.rm = TRUE)

#checked and confirmed all entries are correct

QC.Checks %>% 
  ggplot(aes(x=DW.clean.g, y=Bulk.Density))+
  geom_point()

QC.Checks %>% 
  ggplot(aes(x=Site, y=Bulk.Density))+
  geom_point()

```
Check data entry for values less that 1.4 WITH THE DATASIZE ADDED SO MODIFICATION OF THE SCRIPT 
```{r}

QC.Checks <- data_1_clean %>%
  filter(Bulk.Density <1.4, na.rm = TRUE)

#checked and confirmed all entries are correct

QC.Checks %>% 
  ggplot(aes(x=DW.clean.g, y=Bulk.Density))+
  geom_point()

QC.Checks %>% 
  ggplot(aes(x=Site, y=Bulk.Density))+
  geom_point()

```

Set species colors
```{r}

species_colors <- c("P. tuahiniensis" = "#D55E00",
                    "P. meandrina" = "pink",
                    "P. meandrinaP. grandis" = "#0072B2",
                    "P. verrucosa" = "#E69F00",
                    "P. grandis" = "#56B4E9",
                    "P. effusa" = "#009E73",
                    "P. acuta" = "#e63946")



```

Plot by species and site
```{r}

data$Species <- factor(data$Species, levels = c("P. tuahiniensis", 
                                                "P. meandrina", 
                                                "P. meandrinaP. grandis", 
                                                "P. verrucosa", 
                                                "P. grandis", 
                                                "P. effusa", 
                                                "P. acuta"))

str(data)

#set species order
species_order <- c("P. meandrina","P. meandrinaP. grandis", "P. grandis",
                   "P. verrucosa","P. tuahiniensis", "P. effusa","P. acuta" )  

# Convert species column to a factor with the custom order
data$Species <- factor(data$Species, levels = species_order)


#set site order
site_order <- c("S1","S2","S3","S4","S5","S6",
                "S9","S11","S12","S14","S15","S18")  

# Convert Site column to a factor with the custom order
data$Site <- factor(data$Site, levels = site_order)

# Check the structure to confirm the changes
str(data)


bulk.density.plot.raw <- data %>%
  ggplot(aes(x = Site, y = Bulk.Density, color = Species)) +  # Add 'color = Species' to map colors to the Species variable
  geom_point() +  # Plot the data points
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  facet_wrap(~ Species) +  # Facet by Species
  theme_bw()+
  labs(title="All Raw Data",
    x = "Species",
    y = "Bulk Density g/cm3"
  )  

bulk.density.plot.raw

```
Plot by species and site WITH DATASIZE FILTER SO IN OUR CASE IT'S CALL DATA_1_CLEAN
```{r}

data_1_clean$Species <- factor(data_1_clean$Species, levels = c("P. tuahiniensis", 
                                                "P. meandrina", 
                                                "P. meandrinaP. grandis", 
                                                "P. verrucosa", 
                                                "P. grandis", 
                                                "P. effusa", 
                                                "P. acuta"))

str(data_1_clean)

#set species order
species_order <- c("P. meandrina","P. meandrinaP. grandis", "P. grandis",
                   "P. verrucosa","P. tuahiniensis", "P. effusa","P. acuta" )  

# Convert species column to a factor with the custom order
data_1_clean$Species <- factor(data_1_clean$Species, levels = species_order)


#set site order
site_order <- c("S1","S2","S3","S4","S5","S6",
                "S9","S11","S12","S14","S15","S18")  

# Convert Site column to a factor with the custom order
data_1_clean$Site <- factor(data_1_clean$Site, levels = site_order)

# Check the structure to confirm the changes
str(data_1_clean)


bulk.density.plot.raw <- data_1_clean %>%
  ggplot(aes(x = Site, y = Bulk.Density, color = Species)) +  # Add 'color = Species' to map colors to the Species variable
  geom_point() +  # Plot the data points
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  facet_wrap(~ Species) +  # Facet by Species
  theme_bw()+
  labs(title="All Raw Data",
    x = "Species",
    y = "Bulk Density g/cm3"
  )  

bulk.density.plot.raw

```

```{r}

#remove outliers above 2.93 and below 0
filtered_data <- data %>%
  filter(Bulk.Density <2.93, na.rm = TRUE) %>%
  filter(Bulk.Density >0, na.rm = TRUE)

bulk.density.plot.outlier.removed <- filtered_data %>%
  ggplot(aes(x = Site, y = Bulk.Density, color = Species)) +  # Add 'color = Species' to map colors to the Species variable
  geom_point() +  # Plot the data points
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  facet_wrap(~ Species) +  # Facet by Species
  theme_bw()+
  labs(title="Outlier Removed",
    x = "Species",
    y = "Bulk Density g/cm3"
  )  

bulk.density.plot.outlier.removed


bulk.density.plot.outlier.removed.species <- filtered_data %>%
  ggplot(aes(x = Site, y = Bulk.Density, color = Species, group = Species)) +  # Map color to Species
  geom_point(position = position_dodge(width = 0.9), size = 1, alpha = 0.2) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 3,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  ) + 
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  scale_color_manual(values = species_colors) +  # Use your manual color palette for the species
  theme_classic() +  # Classic theme for cleaner look
  labs(
    title = "Outlier Removed",
    x = "Site",
    y = "Bulk Density g/cm²"
  )

# Display the plot
#bulk.density.plot.outlier.removed.species

```
#SAME CODE AS BEFORE BUT THIS TIME I USE THE CLEAN DATA WITH NO NA AND DATASIZE 
```{r}

#remove outliers above 2.93 and below 0
filtered_data_clean<- data_1_clean %>%
  filter(Bulk.Density <2.93, na.rm = TRUE) %>%
  filter(Bulk.Density >0, na.rm = TRUE)

bulk.density.plot.outlier.removed.clean <- filtered_data_clean %>%
  ggplot(aes(x = Site, y = Bulk.Density, color = Species)) +  # Add 'color = Species' to map colors to the Species variable
  geom_point() +  # Plot the data points
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  facet_wrap(~ Species) +  # Facet by Species
  theme_bw()+
  labs(title="Outlier Removed",
    x = "Species",
    y = "Bulk Density g/cm3"
  )  

bulk.density.plot.outlier.removed.clean


bulk.density.plot.outlier.removed.species.clean <- filtered_data_clean %>%
  ggplot(aes(x = Site, y = Bulk.Density, color = Species, group = Species)) +  # Map color to Species
  geom_point(position = position_dodge(width = 0.9), size = 1, alpha = 0.2) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 3,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  ) + 
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  scale_color_manual(values = species_colors) +  # Use your manual color palette for the species
  theme_classic() +  # Classic theme for cleaner look
  labs(
    title = "Outlier Removed",
    x = "Site",
    y = "Bulk Density g/cm²"
  )

# Display the plot
#bulk.density.plot.outlier.removed.species

```

All species by site
```{r}
bulk.density.site <- filtered_data %>%
  ggplot(aes(x = Site, y = Bulk.Density)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, color="gray", alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    position = position_dodge(width = 0.9))+  # Dodge means to align with the individual points
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none")+
  labs(title="All Species",
       y = "Bulk Density g/cm3"
  )

bulk.density.site

```

All species by site WITH CLEAN DATA (WITH SIZE DATA)
```{r}
bulk.density.site.clean <- filtered_data_clean %>%
  ggplot(aes(x = Site, y = Bulk.Density)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, color="gray", alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    position = position_dodge(width = 0.9))+  # Dodge means to align with the individual points
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none")+
  labs(title="All Species",
       y = "Bulk Density g/cm3"
  )

bulk.density.site.clean

```

All sites by Species
```{r}
bulk.density.species <- filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, color="gray", alpha = 0.3) +  # Plot the individual data points
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9))+  # Dodge means to align with the individual points
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="All Sites",
       y = "Bulk Density g/cm3"
  )

bulk.density.species

```

All sites by Species WITH CLEAN DATA (WITH SIZE DATA)
```{r}
bulk.density.species.clean <- filtered_data_clean %>%
  ggplot(aes(x = Species, y = Bulk.Density)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, color="gray", alpha = 0.3) +  # Plot the individual data points
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9))+  # Dodge means to align with the individual points
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="All Sites",
       y = "Bulk Density g/cm3"
  )

bulk.density.species.clean

```

View a single site S1
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S1") %>%
  filter(Species != "NA")

bulk.density.plot.S1 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S1",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S1

```


View a single site S2
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S2") %>%
  filter(Species != "NA")

bulk.density.plot.S2 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S2",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S2

```

ploting the site 2 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S2") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S2") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s2.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s2.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 2",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s2.bulk.pdf", plot = size.s2.bulk, width = 10, height = 6, dpi = 300)
size.s2.bulk
```

View a single site S3
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S3") %>%
  filter(Species != "NA")

bulk.density.plot.S3 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S3",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S3

```

ploting the site 3 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S3") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S3") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s3.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s3.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 3",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s3.bulk.pdf", plot = size.s3.bulk, width = 10, height = 6, dpi = 300)
size.s3.bulk
```

View a single site S4
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S4") %>%
  filter(Species != "NA") %>%
  filter(!Species %in% c("P. effusa", "P. acuta"))

bulk.density.plot.S4 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position =,
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S4",
    y = "Bulk Density g/cm3"
  )

ggsave("bulk.density.plot.S4.pdf", plot = bulk.density.plot.S4, width = 10, height = 6, dpi = 300)
bulk.density.plot.S4

```

ploting the site 4 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S4") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S4") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s4.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s4.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 4",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s4.bulk.pdf", plot = size.s4.bulk, width = 10, height = 6, dpi = 300)
size.s4.bulk
```

View a single site S5
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S5") %>%
  filter(Species != "NA")

bulk.density.plot.S5 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S5",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S5

```

ploting the site 5 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S5") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S5") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s5.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S5)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s5.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 5",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s5.bulk.pdf", plot = size.s5.bulk, width = 10, height = 6, dpi = 300)
size.s5.bulk
```

View a single site S6
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S6") %>%
  filter(Species != "NA")

bulk.density.plot.S6 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S6",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S6

```

ploting the site 6 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S6") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S6") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s6.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s6.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 6",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s6.bulk.pdf", plot = size.s6.bulk, width = 10, height = 6, dpi = 300)
size.s6.bulk
```

View a single site S9
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S9") %>%
  filter(Species != "NA")

bulk.density.plot.S9 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S9",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S9

```

ploting the site 9 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S9") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S9") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s9.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s9.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 9",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s9.bulk.pdf", plot = size.s9.bulk, width = 10, height = 6, dpi = 300)
size.s9.bulk
```


View a single site S11
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S11") %>%
  filter(Species != "NA")

bulk.density.plot.S11 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S11",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S11

```

ploting the site 11 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S11") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S11") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s11.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s11.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 11",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s11.bulk.pdf", plot = size.s14.bulk, width = 10, height = 6, dpi = 300)
size.s11.bulk
```


View a single site S12
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S12") %>%
  filter(Species != "NA")

bulk.density.plot.S12 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S12",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S12

```

ploting the site 12 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S12") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S12") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s12.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s12.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 12",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s12.bulk.pdf", plot = size.s12.bulk, width = 10, height = 6, dpi = 300)
size.s12.bulk
```


View a single site S14
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S14") %>%
  filter(Species != "NA") %>%
  filter(!Species %in% c("P. effusa", "P. acuta"))

bulk.density.plot.S14 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position =,
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S14",
    y = "Bulk Density g/cm3"
  )

ggsave("bulk.density.plot.S14.pdf", plot = bulk.density.plot.S14, width = 10, height = 6, dpi = 300)
bulk.density.plot.S14

```

ploting the site 14 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S14") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S14") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s14.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s14.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 14",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s14.bulk.pdf", plot = size.s14.bulk, width = 10, height = 6, dpi = 300)
size.s14.bulk
```


View a single site S15
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S15") %>%
  filter(Species != "NA")

bulk.density.plot.S15 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S15",
    y = "Bulk Density g/cm3"
  )

bulk.density.plot.S15

```

ploting the site 15 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 2 
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S15") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S15") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s15.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S14)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s15.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
scale_fill_manual(values = species_colors)  +
  theme_classic() +
  labs(
    title = "Site 15",
    y = "Bulk Density (g/cm³)",
    x = "Species",
    fill = "Size Class"
  ) +
  # to change the species name color for legend on y axes
 theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)
  )

ggsave("size.s15.bulk.pdf", plot = size.s15.bulk, width = 10, height = 6, dpi = 300)
size.s15.bulk
```


View a single site S18
```{r}
#remove max outlier
site_filtered_data <- filtered_data %>%
  filter(Site == "S18") %>%
  filter(Species != "NA")

bulk.density.plot.S18 <- site_filtered_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species, group = Species)) +  # Add 'color = Species' to map colors to the Species variable
   geom_point(position = position_dodge(width = 0.9), size = 2, alpha = 0.3) +  # Plot the individual data points
  stat_summary(
    fun = "mean",  # Compute the mean
    geom = "point",  # Add the mean as a point
    size = 5,  # Size of the mean points
    shape = 18,  # Diamond shape for mean points
    aes(color = Species),  # Make the mean points the same color as the species
    position = position_dodge(width = 0.9)  # Dodge means to align with the individual points
  )+
  scale_color_manual(values = species_colors) +  # Apply the manual color scale
  geom_line(
    stat = "summary",  # Use the summary statistics (mean) to plot the line
    fun = "mean",  # Line connects the means
    aes(group = Species, color = Species),  # Ensure the line connects the means of each species
    size = 1,  # Thickness of the line
  position = position_dodge(width = 0.9)) +
  ylim(1.0, 2.4)+
  theme_bw()+
  theme(legend.position ="none",
        axis.title.x = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_line())+
  labs(title="S18",
    y = "Bulk Density g/cm3"
  )

ggsave("bulk.density.plot.S18",height = 16, width = 10) 

bulk.density.plot.S18

```

ploting the site 18 to see the bulk desnity depending of their species and their sizes 
```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 18
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S18") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  filter(Site == "S18") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.s18.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class (Site S18)",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.s18.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
  scale_fill_manual(values = species_colors) +
  theme_classic() +
  labs(
    title = "Site 18",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
  theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)) #,
#legend.position = "bottom") 

ggsave("size.s18.bulk.pdf", plot = size.s18.bulk, width = 10, height = 6, dpi = 300)

size.s18.bulk
```

```{r}
# first we need to calculate the average size from the 3 diameters i have in my datset 
filtered_data_clean <- filtered_data_clean %>%
  mutate(Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE))

#filter for site 18
site_filtered_data <- filtered_data_clean %>%
  #filter(Site == "S18") %>%
  filter(!is.na(Species))

# new try with the size categories as POC RA code and graphs
# Step 1: Filter data for site S2 and calculate average size
site_filtered_data <- filtered_data_clean %>%
  #filter(Site == "S18") %>%
  filter(!is.na(Species)) %>%
  mutate(
    Avg.Size = rowMeans(select(., Diameter.1, Diameter.2, Diameter.3), na.rm = TRUE)
  )

# Step 2: Create size classes using custom breaks and labels
breaks <- c(0, 2, 5, 14, Inf)  # Adjust these values as needed
labels <- c("0-2cm", ">2cm-5cm", ">5cm-14cm", ">14cm")  # Category labels

site_filtered_data <- site_filtered_data %>%
  mutate(Size.Class = cut(Avg.Size,
                          breaks = breaks,
                          include.lowest = TRUE,
                          labels = labels,
                          right = FALSE))  # right = FALSE makes the intervals left-inclusive

# Step 3: Plot bulk density per species, colored by custom size class
size.sall.bulk <- ggplot(site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), alpha = 0.3, size = 1) +
  scale_fill_manual(values = c("0-2cm" = "#66c2a5", 
                               ">2cm-5cm" = "#fc8d62", 
                               ">5cm-14cm" = "#8da0cb", 
                               ">14cm" = "#e78ac3")) +  # Custom colors for each size class
  theme_classic() +
  labs(
    title = "Bulk Density per Species by Custom Size Class",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  )

species_colors <- c(
  "P. tuahiniensis" = "#D55E00",
  "P. meandrina" = "pink",
  "P. meandrinaP. grandis" = "#0072B2",
  "P. verrucosa" = "#E69F00",
  "P. grandis" = "#56B4E9",
  "P. effusa" = "#009E73",
  "P. acuta" = "#e63946"
)
  
# the final plot 
size.sall.bulk <- ggplot (site_filtered_data, aes(x = Size.Class, y = Bulk.Density, fill = Species)) +
  geom_boxplot(alpha = 0.7, outlier.shape = NA) +
  geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), 
              alpha = 0.3, size = 1) +
  scale_fill_manual(values = species_colors) +
  theme_classic() +
  labs(
    title = "All site",
    y = "Bulk Density (g/cm³)",
    x = "Size.Class",
    fill = "Species"
  ) +
  # to change the species name color for legend on y axes
  theme(
    axis.text.x = element_text(color = "black", angle = 0, hjust = 0.5)) #,
#legend.position = "bottom") 

ggsave("size.sall.bulk.pdf", plot = size.sall.bulk, width = 10, height = 6, dpi = 300)

size.sall.bulk
```



plot to pdf
```{r}
# Save the plots to a PDF in one column
pdf("Output/BW.plots.pdf", height = 16, width = 10) # Set dimensions for the PDF
grid.arrange(bulk.density.plot.raw,
             bulk.density.plot.outlier.removed,
             bulk.density.plot.outlier.removed.species,
            ncol = 1) # Arrange in 1 column
dev.off() # Close the PDF device

# Save the plots to a PDF in one column
pdf("Output/BDSite.plots.pdf", height = 18, width = 12) # Set dimensions for the PDF
grid.arrange(bulk.density.plot.S1,bulk.density.plot.S2,
             bulk.density.plot.S3,bulk.density.plot.S4,
             bulk.density.plot.S5,bulk.density.plot.S6,
             bulk.density.plot.S9,bulk.density.plot.S11,
             bulk.density.plot.S12,bulk.density.plot.S14,
             bulk.density.plot.S15, bulk.density.plot.S18,
             ncol = 3) # Arrange in 1 column
dev.off() # Close the PDF device

```

Plot all the graph in one place with the sizes! 
```{r}

size.s2.bulk <- size.s2.bulk + theme(legend.position = "none")
size.s3.bulk <- size.s3.bulk + theme(legend.position = "none")
size.s4.bulk <- size.s4.bulk + theme(legend.position = "none")
size.s5.bulk <- size.s5.bulk + theme(legend.position = "none")
size.s6.bulk <- size.s6.bulk + theme(legend.position = "none")
size.s9.bulk <- size.s9.bulk + theme(legend.position = "none")
size.s11.bulk <- size.s11.bulk + theme(legend.position = "none")
size.s12.bulk <- size.s12.bulk + theme(legend.position = "none")
size.s14.bulk <- size.s14.bulk + theme(legend.position = "none")
size.s15.bulk <- size.s15.bulk + theme(legend.position = "none")
size.s18.bulk <- size.s18.bulk + theme(legend.position = "none")
size.sall.bulk <- size.sall.bulk + theme(legend.position = "none")

size.s2.bulk <- size.s2.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank()) 
size.s3.bulk <- size.s3.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s4.bulk <- size.s4.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s5.bulk <- size.s5.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s6.bulk <- size.s6.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s9.bulk <- size.s9.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s11.bulk <- size.s11.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s12.bulk <- size.s12.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s14.bulk <- size.s14.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s15.bulk <- size.s15.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.s18.bulk <- size.s18.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())
size.sall.bulk <- size.sall.bulk + theme(axis.text.x = element_blank(),
                                     axis.ticks.x = element_blank())

# Save the plots to a PDF in one column
pdf("Output/BD.sizes.per.site.pdf", height = 16, width = 10) # Set dimensions for the PDF
grid.arrange(bulk.density.plot.raw,
             bulk.density.plot.outlier.removed,
             bulk.density.plot.outlier.removed.species,
            ncol = 1) # Arrange in 1 column
dev.off() # Close the PDF device

# Save the plots to a PDF in one column
pdf("Output/BD.sizes.per.site.pdf", height = 18, width = 12) # Set dimensions for the PDF
grid.arrange(size.s2.bulk,size.s3.bulk,
             size.s4.bulk,size.s5.bulk,
             size.s6.bulk,size.s9.bulk,
             size.s11.bulk,size.s12.bulk,
             size.s14.bulk,size.s15.bulk,
             size.s18.bulk, size.sall.bulk,
             ncol = 2) # Arrange in 1 column
dev.off() # Close the PDF device

 
```


 Make the Moorea Island Map
```{r }
register_google(key = "AIzaSyAJHWQg-KMSzffFNWaO1zAakoBz-klFhIg") ### use your own API

# location
Moorea<-data.frame(lon = -149.83246425684064, lat = -17.531092816791094)

#Map base
M1<-get_map(Moorea,zoom = 12, maptype = 'satellite')

bbx <- c(left=-149.802,bottom= -17.480,right=-149.805,top=-17.475)
x <- c(bbx["left"], bbx["left"], bbx["right"], bbx["right"])
y <- c(bbx["bottom"], bbx["top"], bbx["top"], bbx["bottom"])
df <- data.frame(x, y)

Mooreamap<-ggmap(M1)+
  scalebar(x.min = -149.90, x.max = -149.05,y.min = -17.4, y.max = -18.0,
           model = 'WGS84', box.fill = c("yellow", "white"), st.color = "white",
           location =  "bottomright", transform = TRUE, dist_unit = "km", dist = 10) +
  #geom_polygon(aes(x=x, y=y), data=df, color="yellow", fill=NA) +
  #geom_text(data = isledata, aes(x=Long, y=Lat, label=island),vjust =0,size=4, color = 'yellow')+
  ggtitle('A')+
  xlab("")+
  ylab("")

Mooreamap

```

# Make Colony and Transect Map
```{r}
sitedata <- read.csv("Data/transect.site.coords.csv")
str(sitedata)

labels <- sitedata$site.name

#Map base
#M3<-get_map(NS,zoom = 18, maptype = 'satellite')

MooreaSitemap<-ggmap(M1)+
  scalebar(x.min = -149.75, x.max = -149.79,y.min = -17.60, y.max = -17.58,
           model = 'WGS84', box.fill = c("white", "white"), st.color = "white",st.dist=0.3,
           location =  "bottomright", transform = TRUE, dist_unit = "km", dist = 1) +
  geom_point(data = sitedata, mapping = aes(x=long, y=lat), size=2, color="yellow")+
  geom_text(data = sitedata, aes(x=long, y=lat, label=site.name),vjust = -2,size=3, color="yellow")+
  #geom_line(data = transects, mapping = aes(x=long, y=lat,group=grouping), size=0.5, color="black")+
  #ggtitle('C')+
  xlab("")+
  ylab("")

MooreaSitemap
```

spatial mapping of plots around the island map
```{r}

empty_plot <- ggplot() + theme_void()

legend_plot <- ggplot(data = data.frame(x = 1, y = 1, group = names(species_colors)), aes(x = x, y = y, color = group)) +
  geom_point(size = 0) +  # No actual points, just to display the legend
  scale_color_manual(values = species_colors) +  # Use your custom color palette
  theme_void() +  # Remove axes and background
  theme(legend.title = element_blank()) +  # Remove legend title
  guides(color = guide_legend(override.aes = list(size = 5)))
legend_plot

grid_layout <- plot_grid(
  bulk.density.plot.S1,bulk.density.plot.S2,bulk.density.plot.S3,bulk.density.plot.S4,bulk.density.plot.S5,
  bulk.density.plot.S18,empty_plot,empty_plot,empty_plot,bulk.density.plot.S6,
  bulk.density.plot.S15,empty_plot,empty_plot,empty_plot,bulk.density.plot.S9,
  bulk.density.plot.S14, empty_plot,empty_plot,empty_plot,bulk.density.plot.S11,
  bulk.density.plot.S12, empty_plot,empty_plot,bulk.density.species,legend_plot,
  ncol = 5, nrow = 5
)

final_grid_with_map <- grid_layout + 
  draw_plot(MooreaSitemap, x = 0.2, y = 0.2, width = 0.6, height = 0.6)+  
  draw_plot(bulk.density.site, x = 0.23, y = 0.001, width = 0.36, height = 0.2)
final_grid_with_map 

ggsave("Output/grid_layout.pdf", final_grid_with_map, width = 10, height = 10)


```

combine s4 and s14 to the graph for BioAntifatgue graph 
```{r}
combined_data <- filtered_data %>%
  filter(Species != "NA") %>%
  filter(!Species %in% c("P. effusa", "P. acuta")) %>%
  filter(Site %in% c("S4", "S14"))  # Replace "OtherSite" with your actual second site name

bulk_density_combined_plot <- combined_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Site, group = Site)) +
  
  # Individual points
  geom_point(position = position_dodge(width = 0.7), size = 2, alpha = 0.3) +
  
  # Mean points
  stat_summary(
    fun = "mean",
    geom = "point",
    aes(color = Site),
    size = 5,
    shape = 18,
    position = position_dodge(width = 0.7)
  ) +
  
  # Mean lines
  geom_line(
    stat = "summary",
    fun = "mean",
    aes(group = Site, color = Site),
    size = 1,
    position = position_dodge(width = 0.7)
  ) +
  
  ylim(1.0, 2.4) +
  theme_bw() +
  theme(
    axis.title.x = element_blank(), 
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.ticks.x = element_line()
  ) +
  labs(
    title = "Bulk Density by Species and Site",
    y = "Bulk Density g/cm3",
    color = "Site"
  )

# Plot
bulk_density_combined_plot <- combined_data %>%
  ggplot(aes(x = Species, y = Bulk.Density, color = Species)) +  # color by Species
  geom_point(
    aes(group = Site),  # group by Site for position
    position = position_dodge(width = 0.7),
    size = 2,
    alpha = 0.3
  ) +
  stat_summary(
    fun = "mean",
    geom = "point",
    size = 5,
    shape = 18,
    aes(group = Site),  # position by Site
    position = position_dodge(width = 0.7)
  ) +
  geom_line(
    stat = "summary",
    fun = "mean",
    aes(group = interaction(Species, Site)),  # line by Site within Species
    size = 1,
    position = position_dodge(width = 0.7)
  ) +
  scale_color_manual(values = species_colors) +  # keep species colors
  ylim(1.0, 2.4) +
  theme_bw() +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.ticks.x = element_line()
  ) +
  labs(
    title = "Bulk Density by Species and Site",
    y = "Bulk Density g/cm3",
    color = "Species"
  )


ggsave("bulk_density_combined_plot.pdf", plot = bulk_density_combined_plot, width = 12, height = 6, dpi = 300)
bulk_density_combined_plot

```
Try a new combinaison for showing the graph with the species difference but also the site on the X axe
```{r}
# Define site colors
site_colors <- c("S4" = "#56B4E9", "S14" = "#e63946")


# Filter data: remove NA species and specific species
combined_data <- filtered_data %>%
  filter(!is.na(Species)) %>%
  filter(!Species %in% c("P. effusa", "P. acuta", "P. meandrinaP. grandis")) %>%
  filter(Site %in% c("S4", "S14"))

# Get mean points per Species and Site
mean_data <- combined_data %>%
  group_by(Species, Site) %>%
  summarise(mean_bd = mean(Bulk.Density, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = Site, values_from = mean_bd) %>%
  filter(!is.na(S4) & !is.na(S14))


# Create boxplot
bulk_density_boxplot_1 <- ggplot(combined_data, aes(x = Species, y = Bulk.Density, fill = Site)) +
  
  geom_boxplot(position = position_dodge(width = 0.8), outlier.alpha = 0.2, width = 0.6) +
  
  scale_fill_manual(values = site_colors) +
  ylim(1.0, 2.4) +
  theme_bw() +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.ticks.x = element_line()
  ) +
  labs(
    title = "Bulk Density by Species and Site",
    y = "Bulk Density (g/cm³)",
    fill = "Site"
  )
bulk_density_boxplot_1
ggsave("bulk_density_boxplot_1.pdf", plot = bulk_density_boxplot_1, width = 12, height = 6, dpi = 300)


```
Statistic test between the two site 
```{r}
test_data <- filtered_data %>%
  filter(Species != "NA") %>%
  filter(!Species %in% c("P. effusa", "P. acuta")) %>%
  filter(Site %in% c("S4", "S14")) %>%  # Use your actual sites
  droplevels()

anova_result <- aov(Bulk.Density ~ Species * Site, data = test_data)
summary(anova_result)

library(emmeans)

# Post-hoc pairwise comparisons between species
emmeans_species <- emmeans(anova_result, ~ Species)
pairs(emmeans_species)

```
test if the same species are different depending of the site
```{r}
library(emmeans)

# Run emmeans with site nested within species
emmeans_species_site <- emmeans(anova_result, ~ Site | Species)
pairs(emmeans_species_site)

species_list <- unique(test_data$Species)

for (sp in species_list) {
  cat("\n==== Species:", sp, "====\n")
  species_data <- test_data[test_data$Species == sp, ]
  model <- aov(Bulk.Density ~ Site, data = species_data)
  print(summary(model))
}

```
Adding the p-value on the graph to show the signification 
```{r}
library(ggsignif)

bulk_density_combined_plot + 
  geom_signif(
    comparisons = list(c("S14", "S4")),  # x-axis labels for the two sites
    map_signif_level = TRUE,             # Will show *, **, ***
    annotations = c("*"),                # Optional: you can provide specific p-values or symbols
    y_position = 2.4,                    # Adjust height of the bracket
    tip_length = 0.01                    # Optional tweak
  )

comparisons = list(
  c("P. meandrina\nS14", "P. meandrina\nS4"),
  c("P. verrucosa\nS14", "P. verrucosa\nS4"),
  c("P. tuahiniensis\nS14", "P. tuahiniensis\nS4")
)

bulk_density_combined_plot +
  geom_signif(
    comparisons = comparisons,
    annotations = c("*", "**", "**"),  # Match your p-values or use actual p text
    y_position = c(2.35, 2.4, 2.45),   # Stack brackets higher for each
    tip_length = 0.01
  )


```




